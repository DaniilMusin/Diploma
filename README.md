# Дипломная работа: Классификация изображений кристаллов с использованием глубокого обучения

## Описание проекта

Данная дипломная работа посвящена разработке системы автоматической классификации изображений кристаллов для определения их качества. Проект включает в себя как программную часть (машинное обучение, обработка изображений), так и аппаратную часть (управление температурным режимом выращивания кристаллов).

## Цель работы

Разработка и сравнение различных архитектур глубоких нейронных сетей для бинарной классификации изображений кристаллов на категории "чистый" и "нечистый" с целью автоматизации контроля качества кристаллов.

## Структура проекта

### 1. Модели машинного обучения

#### 1.1 Бинарная классификация
- **`Binary_learning.py`** - обучение моделей ResNet50 и DenseNet121 для бинарной классификации
  - Использует предобученные веса ImageNet
  - Двухэтапное обучение: заморозка слоев → fine-tuning
  - Балансировка классов через взвешенный CrossEntropyLoss
  - K-fold кросс-валидация (K=3)

#### 1.2 Vision Transformer
- **`vit_model.py`** - реализация Vision Transformer (ViT) с нуля
  - Архитектура: ViT-Base (768 dim, 12 layers, 12 heads)
  - Patch embedding (16×16)
  - Mixed precision training (AMP)
  - Оптимизирован для RTX 3080 (batch size: 64)

#### 1.3 Дополнительные модели
- **`InceptionV3, Xception.py`** - обучение моделей InceptionV3 и Xception
- **`train_kfold_four_models_clear_or_not.py`** - K-fold валидация четырех моделей
- **`train_kfold_utf8.py`** - K-fold обучение с поддержкой UTF-8

#### 1.4 Ансамблевое обучение
- **`Ansamble_test_accuracy.py`** - тестирование ансамбля моделей
  - Комбинирование предсказаний нескольких моделей
  - Повышение итоговой точности классификации

### 2. Обработка изображений

- **`crop_gray.py`** - обрезка изображений и преобразование в grayscale
- **`обрезка изображений.py`** - дополнительный скрипт обрезки
- **`обрезание именно само.py`** - специализированная обрезка

### 3. Автоматизация измерений

- **`Automated_Marco.py`** - автоматизированная макросъемка кристаллов

### 4. Аппаратная часть

- **`crystalls_GUI.py`** - графический интерфейс для управления температурным режимом
  - Подключение к Arduino через serial port
  - Настройка температурных циклов
  - Визуализация температуры в реальном времени
  - Логирование параметров процесса

### 5. Визуализация результатов

- **`Генерация графиков.ipynb`** - Jupyter notebook для генерации графиков и анализа результатов

## Используемые технологии

### Машинное обучение
- **PyTorch** - основной фреймворк для обучения нейронных сетей
- **torchvision** - предобученные модели и трансформации изображений
- **scikit-learn** - метрики, K-fold валидация

### Обработка изображений
- **PIL/Pillow** - загрузка и обработка изображений
- **NumPy** - численные операции

### Графический интерфейс и визуализация
- **PyQt5** - создание GUI приложения
- **matplotlib** - построение графиков
- **Jupyter Notebook** - интерактивный анализ данных

### Аппаратная часть
- **pySerial** - взаимодействие с Arduino
- **Arduino** - управление температурным режимом

## Архитектуры нейронных сетей

1. **ResNet50** - остаточная сеть с 50 слоями
2. **DenseNet121** - плотно связанная сеть с 121 слоем
3. **InceptionV3** - сеть с inception-модулями
4. **Xception** - extreme inception
5. **Vision Transformer (ViT)** - трансформер для изображений

## Методология

### Предобработка данных
1. Проверка целостности изображений
2. Конвертация в grayscale (для некоторых моделей)
3. Фильтрация "пустых" изображений (std < 5)
4. Нормализация по ImageNet статистике

### Аугментация данных
- Случайные повороты (до 30°)
- Перспективные искажения
- Горизонтальное и вертикальное отражение
- Случайное изменение яркости и контраста
- Random resized crop

### Стратегия обучения
1. **Этап 1**: Обучение только последнего слоя (20 эпох)
2. **Этап 2**: Fine-tuning всех слоев (10 эпох, LR/10)
3. **Валидация**: K-fold кросс-валидация
4. **Метрики**: Accuracy, Precision, Recall, F1-score

### Балансировка классов
- Вычисление весов классов на основе их распределения
- Использование взвешенного CrossEntropyLoss

## Метрики качества

Для каждой модели рассчитываются следующие метрики:
- **Accuracy** - общая точность классификации
- **Precision** - точность положительных предсказаний
- **Recall** - полнота (чувствительность)
- **F1-score** - гармоническое среднее precision и recall

Результаты усредняются по всем фолдам с расчетом стандартного отклонения.

## Структура данных

```
Diploma/
├── Binary/                    # Выходные модели и логи бинарной классификации
├── checkpoints_vit/          # Чекпоинты Vision Transformer
├── labels_Denis.csv          # CSV файл с метками классов
└── Plates/                   # Директория с изображениями кристаллов
    └── Processed_Grayscale_Images_Cropped/
```

## Требования к окружению

### Python библиотеки
```
torch>=2.0.0
torchvision>=0.15.0
numpy>=1.24.0
pillow>=9.5.0
scikit-learn>=1.2.0
matplotlib>=3.7.0
PyQt5>=5.15.0
pyserial>=3.5
jupyter>=1.0.0
```

### Аппаратные требования
- GPU: NVIDIA RTX 3080 или аналогичная (рекомендуется)
- RAM: минимум 16GB
- Свободное место: минимум 10GB для датасета и моделей

## Запуск проекта

### Обучение моделей

#### Бинарная классификация (ResNet50, DenseNet121)
```bash
python Binary_learning.py
```

#### Vision Transformer
```bash
python vit_model.py
```

#### Ансамбль моделей
```bash
python Ansamble_test_accuracy.py
```

### Обработка изображений
```bash
python crop_gray.py
```

### Управление температурой
```bash
python crystalls_GUI.py
```

### Анализ результатов
```bash
jupyter notebook "Генерация графиков.ipynb"
```

## Результаты

Все результаты обучения сохраняются в соответствующих директориях:
- Логи обучения: `{model_name}_fold{N}_log.txt`
- Лучшие модели по accuracy: `best_acc_{model_name}_fold{N}.pth`
- Лучшие модели по F1-score: `best_f1_{model_name}_fold{N}.pth`
- Сводные результаты: `{model_name}_results.txt`

## Автор

Дипломная работа

## Лицензия

Этот проект создан в образовательных целях.
